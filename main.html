<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <title>Main</title>
    <style>
        #chat {
            border: 1px solid #ccc;
            padding: 10px;
            width: 300px;
            height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        #messageInput {
            width: 200px;
        }
    </style>
</head>

<body>
    <h1 id="welcome"></h1>
    <p>이 페이지는 로그인 후에만 접근할 수 있습니다.</p>
    <button id="logoutBtn">로그아웃</button>

    <div id="chatContainer" style="display: none;">
        <div id="chat"></div>
        <input type="text" id="messageInput" placeholder="메시지를 입력하세요" />
        <button id="sendBtn">보내기</button>
    </div>

    <script>
        const token = localStorage.getItem("token");
        const name = localStorage.getItem("name");

        if (!token || !name) {
            alert("로그인이 필요합니다.");
            window.location.href = "index.html";
        } else {
            document.getElementById("welcome").textContent = `하잉, ${name}님!`;
            document.getElementById("chatContainer").style.display = "block";
        }

        document.getElementById("logoutBtn").addEventListener("click", () => {
            localStorage.clear();
            window.location.href = "index.html";
        });

        const chat = document.getElementById("chat");
        const input = document.getElementById("messageInput");
        const sendBtn = document.getElementById("sendBtn");

        const socket = new WebSocket("wss://YOUR-WEBSOCKET-BACKEND-URL");

        socket.addEventListener("open", () => {
            socket.send(JSON.stringify({ type: "join", name }));
        });

        socket.addEventListener("message", (event) => {
            const { name: sender, message } = JSON.parse(event.data);
            const msg = document.createElement("p");
            msg.innerHTML = `<strong>${sender}:</strong> ${message}`;
            chat.appendChild(msg);
            chat.scrollTop = chat.scrollHeight;
        });

        sendBtn.addEventListener("click", () => {
            const message = input.value;
            if (message.trim() !== "") {
                socket.send(JSON.stringify({ type: "chat", name, message }));
                input.value = "";
            }
        });
    </script>
</body>

</html>